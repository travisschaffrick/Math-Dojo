<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Dojo</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- MathJax configuration with custom macros -->
    <script>
        window.MathJax = {
            tex: {
                macros: {
                    add: ["#1 + #2", 2],
                    sub: ["#1 - #2", 2],
                    mult: ["#1 \\times #2", 2]
                }
            }
        };
    </script>

    <!-- Load MathJax -->
    <script id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
</head>
<body>
    
    <h2>Your Score: {{ session['score'] }}</h2>
    {% if session['user_previous_answer'] == session['previous_answer']%}
    <h3>You were correct!</h3>
    {% else %}
    <h3>Incorrect. The answer was {{ session['previous_answer'] }}</h3>
    {% endif %}
    

    <!-- Display question and timer if time still going -->
    {% if time_remaining %}
    <!-- Timer -->
    <h1>
        Time remaining: <span id="remaining_time"></span>
    </h1>
    

    <h1>\[{{question}}\]</h1>
    <h1>
        <form method=post action=/submit>
            <textarea name=user_answer></textarea>
            <input type=submit name=submit value=submit>
        </form>
    </h1>

    <!-- Else show high score-->
    {% else %}
    
    <!-- High Score-->
    <h2>High Score: {{ session['high_score'] }}</h2>


    {% endif %}

    
    
    <form method=post action=/restart>
        <input type=submit name=restart value=restart>
    </form>

    <p>If answer would be undefined put 1 (division by 0)</p>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <!-- Timer -->
    <script>
        function updateRemainingTime() {
            fetch('/remaining_time')
            .then(response => response.json())
            .then(data => {
                let minutes = Math.floor(data.remaining_time_in_seconds / 60);
                let seconds = Math.floor(data.remaining_time_in_seconds % 60);
                if (seconds < 10) {
                    seconds = "0" + seconds;
                }
                
                let remainingTimeElement = document.getElementById('remaining_time');
                remainingTimeElement.innerHTML = `${minutes}:${seconds}`

                if (data.remaining_time_in_seconds < 0) {
                    location.reload()
                }
            })
        }
        setInterval(updateRemainingTime, 1000);
    </script>
</body>
</html>